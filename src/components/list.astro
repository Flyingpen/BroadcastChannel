---
import Layout from '../layouts/base.astro'
import Header from '../components/header.astro'
import Item from '../components/item.astro'

const { SITE_URL } = Astro.locals
const { channel, before = true, after = true, isItem = false } = Astro.props
const posts = channel.posts ?? []

const beforeCursor = posts[posts.length - 1]?.id
const afterCursor = posts[0]?.id
---

<Layout channel={channel}>
  <slot name="header">
    <Header channel={channel} />
  </slot>

  <div class="space-y-8">
    <div
      class="flex flex-wrap items-center gap-3 rounded-3xl border border-white/30 bg-white/70 px-6 py-3 text-sm text-slate-600 shadow-inner dark:border-white/10 dark:bg-surface-900/70 dark:text-slate-300"
    >
      <span class="relative inline-flex h-2 w-2 rounded-full bg-brand-500">
        <span class="absolute inset-[-6px] rounded-full bg-brand-500/40 blur-sm"></span>
      </span>
      <span class="font-semibold text-surface-900 dark:text-white">实时播报</span>
      <span class="hidden text-slate-500 md:inline">持续同步 Telegram 频道的最新更新。</span>
      <span class="text-slate-500">当前加载 {posts.length} 条内容。</span>
      <button
        onclick="location.reload()"
        title="手动刷新内容"
        class="ml-auto inline-flex h-6 w-6 items-center justify-center rounded-full border border-brand-400/30 bg-brand-400/10 text-brand-500 transition hover:bg-brand-400/20 hover:text-brand-400 dark:text-brand-300"
      >
        <svg class="h-3 w-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"
          ></path>
        </svg>
      </button>
    </div>

    <div class="space-y-6">
      {
        posts.length === 0 ? (
          <div class="glass-panel text-center text-slate-500 dark:text-slate-300">
            暂无内容，可稍后刷新或调整筛选条件。
          </div>
        ) : (
          posts.map((post, index) => <Item post={post} isItem={isItem} index={index} />)
        )
      }
    </div>

    <div
      class="flex flex-col gap-4 rounded-3xl border border-white/30 bg-white/70 p-4 text-sm shadow-inner dark:border-white/10 dark:bg-surface-900/70 md:flex-row md:items-center md:justify-between"
    >
      <div class="flex items-center gap-2 text-slate-500 dark:text-slate-300">
        <span class="inline-flex h-2 w-2 animate-pulse rounded-full bg-brand-500"></span>
        <span>浏览时间线</span>
      </div>
      <div class="flex flex-1 items-center justify-between gap-3 md:justify-end">
        {
          before && beforeCursor > 1 ? (
            <a
              href={`${SITE_URL}before/${beforeCursor}`}
              title="查看更早内容"
              class="inline-flex items-center gap-2 rounded-2xl border border-white/30 bg-white/80 px-4 py-2 font-medium text-slate-600 transition hover:-translate-y-0.5 hover:border-brand-400 hover:text-brand-400 dark:border-white/10 dark:bg-surface-900/70 dark:text-slate-200"
            >
              <span>更早内容</span>
            </a>
          ) : (
            <span class="inline-flex items-center gap-2 rounded-2xl border border-dashed border-white/20 px-4 py-2 text-slate-400 dark:border-white/10 dark:text-slate-600">
              没有更早的内容
            </span>
          )
        }

        {
          after && afterCursor ? (
            <a
              href={`${SITE_URL}after/${afterCursor}`}
              title="查看最新内容"
              class="inline-flex items-center gap-2 rounded-2xl border border-white/30 bg-white/80 px-4 py-2 font-medium text-slate-600 transition hover:-translate-y-0.5 hover:border-brand-400 hover:text-brand-400 dark:border-white/10 dark:bg-surface-900/70 dark:text-slate-200"
            >
              <span>更新内容</span>
            </a>
          ) : (
            <span class="inline-flex items-center gap-2 rounded-2xl border border-dashed border-white/20 px-4 py-2 text-slate-400 dark:border-white/10 dark:text-slate-600">
              已在最新位置
            </span>
          )
        }
      </div>
    </div>
  </div>
</Layout>
